[
    {
        "step": "create_dataiku_project",
        "parameters": {
            "project_key": "CUSTOMER_ANALYSIS",
            "name": "Customer Data Integration",
            "description": "Migrating Alteryx workflows to Dataiku DSS for comprehensive customer data analysis."
        }
    },
    {
        "step": "create_connection",
        "parameters": {
            "connection_name": "PolicyDataConnection",
            "connection_type": "File",
            "folder_path": "tfs://dataeconomy-9k42/62457/uploads/62457/29aabe9d-c354-4176-8f98-2dd7a5fd7216/",
            "dataset_name": "policy.csv"
        }
    },
    {
        "step": "create_connection",
        "parameters": {
            "connection_name": "DemographicsDataConnection",
            "connection_type": "File",
            "folder_path": "tfs://dataeconomy-9k42/62457/uploads/62457/29aabe9d-c354-4176-8f98-2dd7a5fd7216/",
            "dataset_name": "demographics.csv"
        }
    },
    {
        "step": "create_connection",
        "parameters": {
            "connection_name": "ClaimsDataConnection",
            "connection_type": "File",
            "folder_path": "tfs://dataeconomy-9k42/62457/uploads/62457/29aabe9d-c354-4176-8f98-2dd7a5fd7216/",
            "dataset_name": "claims.csv"
        }
    },
    {
        "step": "create_connection",
        "parameters": {
            "connection_name": "ScoresDataConnection",
            "connection_type": "File",
            "folder_path": "tfs://dataeconomy-9k42/62457/uploads/62457/29aabe9d-c354-4176-8f98-2dd7a5fd7216/",
            "dataset_name": "scores.csv"
        }
    },
    {
        "step": "create_connection",
        "parameters": {
            "connection_name": "AIMLInsightsDataConnection",
            "connection_type": "File",
            "folder_path": "tfs://dataeconomy-9k42/62457/uploads/62457/29aabe9d-c354-4176-8f98-2dd7a5fd7216/",
            "dataset_name": "aiml_insights.csv"
        }
    },
    {
        "step": "create_dataset",
        "parameters": {
            "project_key": "CUSTOMER_ANALYSIS",
            "dataset_name": "PolicyData",
            "connection_name": "PolicyDataConnection",
            "format": "CSV"
        }
    },
    {
        "step": "create_dataset",
        "parameters": {
            "project_key": "CUSTOMER_ANALYSIS",
            "dataset_name": "DemographicsData",
            "connection_name": "DemographicsDataConnection",
            "format": "CSV"
        }
    },
    {
        "step": "create_dataset",
        "parameters": {
            "project_key": "CUSTOMER_ANALYSIS",
            "dataset_name": "ClaimsData",
            "connection_name": "ClaimsDataConnection",
            "format": "CSV"
        }
    },
    {
        "step": "create_dataset",
        "parameters": {
            "project_key": "CUSTOMER_ANALYSIS",
            "dataset_name": "ScoresData",
            "connection_name": "ScoresDataConnection",
            "format": "CSV"
        }
    },
    {
        "step": "create_dataset",
        "parameters": {
            "project_key": "CUSTOMER_ANALYSIS",
            "dataset_name": "AIMLInsightsData",
            "connection_name": "AIMLInsightsDataConnection",
            "format": "CSV"
        }
    },
    {
        "step": "create_recipe",
        "parameters": {
            "project_key": "CUSTOMER_ANALYSIS",
            "recipe_name": "SelectDemographicsFields",
            "type": "Prepare",
            "input_dataset": "DemographicsData",
            "output_dataset": "SelectedDemographicsData",
            "actions": [
                {
                    "action": "Select",
                    "parameters": {
                        "columns": [
                            "Customer_ID",
                            "Customer_Name",
                            "Email",
                            "Phone_Number",
                            "Address",
                            "City",
                            "State",
                            "Postal_Code",
                            "Date_of_Birth",
                            "Gender",
                            "Marital_Status",
                            "Occupation",
                            "Income_Level",
                            "Customer_Segment"
                        ]
                    }
                }
            ]
        }
    },
    {
        "step": "create_recipe",
        "parameters": {
            "project_key": "CUSTOMER_ANALYSIS",
            "recipe_name": "SelectClaimsFields",
            "type": "Prepare",
            "input_dataset": "ClaimsData",
            "output_dataset": "SelectedClaimsData",
            "actions": [
                {
                    "action": "Select",
                    "parameters": {
                        "columns": [
                            "Claim_ID",
                            "Policy_ID",
                            "Claim_Date",
                            "Claim_Type",
                            "Claim_Status",
                            "Claim_Amount",
                            "Claim_Payout"
                        ]
                    }
                }
            ]
        }
    },
    {
        "step": "create_recipe",
        "parameters": {
            "project_key": "CUSTOMER_ANALYSIS",
            "recipe_name": "SelectPolicyFields",
            "type": "Prepare",
            "input_dataset": "PolicyData",
            "output_dataset": "SelectedPolicyData",
            "actions": [
                {
                    "action": "Select",
                    "parameters": {
                        "columns": [
                            "policy_id",
                            "customer_id",
                            "policy_type",
                            "policy_status",
                            "policy_start_date",
                            "policy_end_date",
                            "policy_term",
                            "policy_premium",
                            "total_premium_paid",
                            "renewal_status",
                            "policy_addons"
                        ]
                    }
                }
            ]
        }
    },
    {
        "step": "create_recipe",
        "parameters": {
            "project_key": "CUSTOMER_ANALYSIS",
            "recipe_name": "JoinDemographicsPolicy",
            "type": "Join",
            "input_datasets": [
                "SelectedDemographicsData",
                "SelectedPolicyData"
            ],
            "output_dataset": "JoinedDemographicsPolicyData",
            "join_type": "Inner",
            "join_conditions": [
                {
                    "left_column": "Customer_ID",
                    "right_column": "customer_id"
                }
            ]
        }
    },
    {
        "step": "create_recipe",
        "parameters": {
            "project_key": "CUSTOMER_ANALYSIS",
            "recipe_name": "JoinClaimsPolicy",
            "type": "Join",
            "input_datasets": [
                "JoinedDemographicsPolicyData",
                "SelectedClaimsData"
            ],
            "output_dataset": "JoinedClaimsPolicyData",
            "join_type": "Inner",
            "join_conditions": [
                {
                    "left_column": "policy_id",
                    "right_column": "Policy_ID"
                }
            ]
        }
    },
    {
        "step": "create_recipe",
        "parameters": {
            "project_key": "CUSTOMER_ANALYSIS",
            "recipe_name": "SummarizeClaimsData",
            "type": "Group",
            "input_dataset": "JoinedClaimsPolicyData",
            "output_dataset": "SummarizedClaimsData",
            "group_by": [
                "Customer_ID"
            ],
            "aggregations": [
                {
                    "column": "Claim_ID",
                    "type": "count",
                    "output_column": "Total_Claims"
                },
                {
                    "column": "policy_id",
                    "type": "count",
                    "output_column": "Policy_Count"
                },
                {
                    "column": "Claim_Date",
                    "type": "max",
                    "output_column": "Recent_Claim_Date"
                },
                {
                    "column": "Claim_Amount",
                    "type": "avg",
                    "output_column": "Average_Claim_Amount"
                }
            ]
        }
    },
    {
        "step": "create_recipe",
        "parameters": {
            "project_key": "CUSTOMER_ANALYSIS",
            "recipe_name": "JoinSummarizedData",
            "type": "Join",
            "input_datasets": [
                "SummarizedClaimsData",
                "JoinedClaimsPolicyData"
            ],
            "output_dataset": "FinalJoinedData",
            "join_type": "Inner",
            "join_conditions": [
                {
                    "left_column": "Customer_ID",
                    "right_column": "Customer_ID"
                }
            ]
        }
    },
    {
        "step": "create_recipe",
        "parameters": {
            "project_key": "CUSTOMER_ANALYSIS",
            "recipe_name": "CalculateMetrics",
            "type": "Prepare",
            "input_dataset": "FinalJoinedData",
            "output_dataset": "CalculatedMetricsData",
            "actions": [
                {
                    "action": "Formula",
                    "parameters": {
                        "formulas": [
                            {
                                "output_column": "Age",
                                "formula": "DateTimeDiff(DateTimeToday(), [Date_of_Birth], 'years')"
                            },
                            {
                                "output_column": "Claim_To_Premium_Ratio",
                                "formula": "IIF([total_premium_paid] != 0, [Claim_Amount]/[total_premium_paid], 0)"
                            },
                            {
                                "output_column": "Claims_Per_Policy",
                                "formula": "IIF([Policy_Count] != 0, [Total_Claims]/[Policy_Count], 0)"
                            },
                            {
                                "output_column": "Retention_Rate",
                                "formula": "0.85"
                            },
                            {
                                "output_column": "Cross_Sell_Opportunities",
                                "formula": "'Multi-Policy Discount, Home Coverage Add-on'"
                            },
                            {
                                "output_column": "Upsell_Potential",
                                "formula": "'Premium Vehicle Coverage'"
                            }
                        ]
                    }
                }
            ]
        }
    },
    {
        "step": "create_recipe",
        "parameters": {
            "project_key": "CUSTOMER_ANALYSIS",
            "recipe_name": "SelectAIMLFields",
            "type": "Prepare",
            "input_dataset": "AIMLInsightsData",
            "output_dataset": "SelectedAIMLData",
            "actions": [
                {
                    "action": "Select",
                    "parameters": {
                        "columns": [
                            "Customer_ID",
                            "Churn_Probability",
                            "Next_Best_Offer",
                            "Claims_Fraud_Probability",
                            "Revenue_Potential"
                        ]
                    }
                }
            ]
        }
    },
    {
        "step": "create_recipe",
        "parameters": {
            "project_key": "CUSTOMER_ANALYSIS",
            "recipe_name": "SelectScoresFields",
            "type": "Prepare",
            "input_dataset": "ScoresData",
            "output_dataset": "SelectedScoresData",
            "actions": [
                {
                    "action": "Select",
                    "parameters": {
                        "columns": [
                            "Customer_ID",
                            "Credit_Score",
                            "Fraud_Score",
                            "Customer_Risk_Score"
                        ]
                    }
                }
            ]
        }
    },
    {
        "step": "create_recipe",
        "parameters": {
            "project_key": "CUSTOMER_ANALYSIS",
            "recipe_name": "JoinAllData",
            "type": "Join",
            "input_datasets": [
                "CalculatedMetricsData",
                "SelectedAIMLData",
                "SelectedScoresData"
            ],
            "output_dataset": "Customer360Data",
            "join_type": "Inner",
            "join_conditions": [
                {
                    "left_column": "Customer_ID",
                    "right_column": "Customer_ID"
                }
            ]
        }
    },
    {
        "step": "create_output",
        "parameters": {
            "project_key": "CUSTOMER_ANALYSIS",
            "output_name": "Customer_360.csv",
            "connection_name": "Customer360Connection",
            "format": "CSV",
            "output_dataset": "Customer360Data"
        }
    }
]