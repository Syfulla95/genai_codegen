[
    {
        "step": "create_dataiku_project",
        "parameters": {
            "project_key": "CUSTOMER_ANALYSIS",
            "name": "Customer Data Integration",
            "description": "Migrating Alteryx workflows to Dataiku DSS for comprehensive customer data analysis."
        }
    },
    {
        "step": "create_connection",
        "parameters": {
            "connection_name": "PolicyDataConnection",
            "connection_type": "File",
            "folder_path": "tfs://dataeconomy-9k42/62457/uploads/62457/29aabe9d-c354-4176-8f98-2dd7a5fd7216/",
            "dataset_name": "policy.csv"
        }
    },
    {
        "step": "create_connection",
        "parameters": {
            "connection_name": "ClaimsDataConnection",
            "connection_type": "File",
            "folder_path": "tfs://dataeconomy-9k42/62457/uploads/62457/29aabe9d-c354-4176-8f98-2dd7a5fd7216/",
            "dataset_name": "claims.csv"
        }
    },
    {
        "step": "create_connection",
        "parameters": {
            "connection_name": "DemographicsDataConnection",
            "connection_type": "File",
            "folder_path": "tfs://dataeconomy-9k42/62457/uploads/62457/29aabe9d-c354-4176-8f98-2dd7a5fd7216/",
            "dataset_name": "demographics.csv"
        }
    },
    {
        "step": "create_connection",
        "parameters": {
            "connection_name": "ScoresDataConnection",
            "connection_type": "File",
            "folder_path": "tfs://dataeconomy-9k42/62457/uploads/62457/29aabe9d-c354-4176-8f98-2dd7a5fd7216/",
            "dataset_name": "scores.csv"
        }
    },
    {
        "step": "create_connection",
        "parameters": {
            "connection_name": "AIMLInsightsDataConnection",
            "connection_type": "File",
            "folder_path": "tfs://dataeconomy-9k42/62457/uploads/62457/29aabe9d-c354-4176-8f98-2dd7a5fd7216/",
            "dataset_name": "aiml_insights.csv"
        }
    },
    {
        "step": "import_data",
        "parameters": {
            "project_key": "CUSTOMER_ANALYSIS",
            "dataset_name": "policy.csv",
            "connection_name": "PolicyDataConnection"
        }
    },
    {
        "step": "import_data",
        "parameters": {
            "project_key": "CUSTOMER_ANALYSIS",
            "dataset_name": "claims.csv",
            "connection_name": "ClaimsDataConnection"
        }
    },
    {
        "step": "import_data",
        "parameters": {
            "project_key": "CUSTOMER_ANALYSIS",
            "dataset_name": "demographics.csv",
            "connection_name": "DemographicsDataConnection"
        }
    },
    {
        "step": "import_data",
        "parameters": {
            "project_key": "CUSTOMER_ANALYSIS",
            "dataset_name": "scores.csv",
            "connection_name": "ScoresDataConnection"
        }
    },
    {
        "step": "import_data",
        "parameters": {
            "project_key": "CUSTOMER_ANALYSIS",
            "dataset_name": "aiml_insights.csv",
            "connection_name": "AIMLInsightsDataConnection"
        }
    },
    {
        "step": "create_recipe",
        "parameters": {
            "recipe_type": "select",
            "input_dataset": "demographics.csv",
            "output_dataset": "selected_demographics",
            "fields": [
                "Customer_ID",
                "Customer_Name",
                "Email",
                "Phone_Number",
                "Address",
                "City",
                "State",
                "Postal_Code",
                "Date_of_Birth",
                "Gender",
                "Marital_Status",
                "Occupation",
                "Income_Level",
                "Customer_Segment"
            ]
        }
    },
    {
        "step": "create_recipe",
        "parameters": {
            "recipe_type": "select",
            "input_dataset": "claims.csv",
            "output_dataset": "selected_claims",
            "fields": [
                "Claim_ID",
                "Policy_ID",
                "Claim_Date",
                "Claim_Type",
                "Claim_Status",
                "Claim_Amount",
                "Claim_Payout"
            ]
        }
    },
    {
        "step": "create_recipe",
        "parameters": {
            "recipe_type": "select",
            "input_dataset": "policy.csv",
            "output_dataset": "selected_policy",
            "fields": [
                "policy_id",
                "customer_id",
                "policy_type",
                "policy_status",
                "policy_start_date",
                "policy_end_date",
                "policy_term",
                "policy_premium",
                "total_premium_paid",
                "renewal_status",
                "policy_addons"
            ]
        }
    },
    {
        "step": "create_recipe",
        "parameters": {
            "recipe_type": "join",
            "input_datasets": [
                "selected_demographics",
                "selected_policy"
            ],
            "output_dataset": "joined_demographics_policy",
            "join_type": "inner",
            "join_conditions": [
                {
                    "left": "Customer_ID",
                    "right": "customer_id"
                }
            ]
        }
    },
    {
        "step": "create_recipe",
        "parameters": {
            "recipe_type": "join",
            "input_datasets": [
                "joined_demographics_policy",
                "selected_claims"
            ],
            "output_dataset": "joined_all_data",
            "join_type": "inner",
            "join_conditions": [
                {
                    "left": "policy_id",
                    "right": "Policy_ID"
                }
            ]
        }
    },
    {
        "step": "create_recipe",
        "parameters": {
            "recipe_type": "summarize",
            "input_dataset": "joined_all_data",
            "output_dataset": "summarized_data",
            "group_by": [
                "Customer_ID"
            ],
            "aggregations": [
                {
                    "field": "Claim_ID",
                    "type": "count",
                    "alias": "Total_Claims"
                },
                {
                    "field": "policy_id",
                    "type": "count",
                    "alias": "Policy_Count"
                },
                {
                    "field": "Claim_Date",
                    "type": "max",
                    "alias": "Recent_Claim_Date"
                },
                {
                    "field": "Claim_Amount",
                    "type": "avg",
                    "alias": "Average_Claim_Amount"
                }
            ]
        }
    },
    {
        "step": "create_recipe",
        "parameters": {
            "recipe_type": "join",
            "input_datasets": [
                "summarized_data",
                "joined_all_data"
            ],
            "output_dataset": "final_joined_data",
            "join_type": "inner",
            "join_conditions": [
                {
                    "left": "Customer_ID",
                    "right": "Customer_ID"
                }
            ]
        }
    },
    {
        "step": "create_recipe",
        "parameters": {
            "recipe_type": "formula",
            "input_dataset": "final_joined_data",
            "output_dataset": "calculated_metrics",
            "calculations": [
                {
                    "field": "Age",
                    "formula": "DateTimeDiff(DateTimeToday(), [Date_of_Birth], 'years')"
                },
                {
                    "field": "Claim_To_Premium_Ratio",
                    "formula": "IIF([total_premium_paid] != 0, [Claim_Amount]/[total_premium_paid], 0)"
                },
                {
                    "field": "Claims_Per_Policy",
                    "formula": "IIF([Policy_Count] != 0, [Total_Claims]/[Policy_Count], 0)"
                },
                {
                    "field": "Retention_Rate",
                    "formula": "0.85"
                },
                {
                    "field": "Cross_Sell_Opportunities",
                    "formula": "'Multi-Policy Discount, Home Coverage Add-on'"
                },
                {
                    "field": "Upsell_Potential",
                    "formula": "'Premium Vehicle Coverage'"
                }
            ]
        }
    },
    {
        "step": "create_recipe",
        "parameters": {
            "recipe_type": "select",
            "input_dataset": "aiml_insights.csv",
            "output_dataset": "selected_aiml_insights",
            "fields": [
                "Customer_ID",
                "Churn_Probability",
                "Next_Best_Offer",
                "Claims_Fraud_Probability",
                "Revenue_Potential"
            ]
        }
    },
    {
        "step": "create_recipe",
        "parameters": {
            "recipe_type": "select",
            "input_dataset": "scores.csv",
            "output_dataset": "selected_scores",
            "fields": [
                "Customer_ID",
                "Credit_Score",
                "Fraud_Score",
                "Customer_Risk_Score"
            ]
        }
    },
    {
        "step": "create_recipe",
        "parameters": {
            "recipe_type": "join",
            "input_datasets": [
                "calculated_metrics",
                "selected_aiml_insights",
                "selected_scores"
            ],
            "output_dataset": "Customer_360",
            "join_type": "inner",
            "join_conditions": [
                {
                    "left": "Customer_ID",
                    "right": "Customer_ID"
                }
            ]
        }
    },
    {
        "step": "export_data",
        "parameters": {
            "project_key": "CUSTOMER_ANALYSIS",
            "dataset_name": "Customer_360",
            "connection_name": "Customer360Connection",
            "file_path": "tfs://dataeconomy-9k42/62457/uploads/62457/Customer_360.csv"
        }
    }
]