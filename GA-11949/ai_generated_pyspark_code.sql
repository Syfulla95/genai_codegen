"-- BigQuery SQL Script for Alteryx Workflow Migration\n\nWITH date_conversions AS (\n  SELECT\n    FORMAT_TIMESTAMP('%Y-%m-%d', CURRENT_TIMESTAMP()) AS today,\n    FORMAT_TIMESTAMP('%Y-%m-%d', TIMESTAMP_SUB(CURRENT_TIMESTAMP(), INTERVAL 1 DAY)) AS yesterday,\n    FORMAT_TIMESTAMP('%Y-%m-%d', TIMESTAMP_SUB(CURRENT_TIMESTAMP(), INTERVAL 7 DAY)) AS prior_week_start,\n    FORMAT_TIMESTAMP('%Y-%m-%d', TIMESTAMP_SUB(CURRENT_TIMESTAMP(), INTERVAL 1 DAY)) AS prior_week_end,\n    FORMAT_TIMESTAMP('%Y-%m-%d', TIMESTAMP_SUB(CURRENT_TIMESTAMP(), INTERVAL 1 MONTH)) AS p1m_start,\n    FORMAT_TIMESTAMP('%Y-%m-%d', TIMESTAMP_SUB(CURRENT_TIMESTAMP(), INTERVAL 1 DAY)) AS p1m_end,\n    FORMAT_TIMESTAMP('%Y-%m-%d', TIMESTAMP_SUB(CURRENT_TIMESTAMP(), INTERVAL 2 MONTH)) AS p2m_start,\n    FORMAT_TIMESTAMP('%Y-%m-%d', TIMESTAMP_SUB(CURRENT_TIMESTAMP(), INTERVAL 1 DAY)) AS p2m_end,\n    FORMAT_TIMESTAMP('%Y-%m-%d', TIMESTAMP_SUB(CURRENT_TIMESTAMP(), INTERVAL 3 MONTH)) AS p3m_start,\n    FORMAT_TIMESTAMP('%Y-%m-%d', TIMESTAMP_SUB(CURRENT_TIMESTAMP(), INTERVAL 1 DAY)) AS p3m_end\n)\n\nSELECT\n  -- Select and rename fields\n  sales.so_audat AS so_date,\n  sales.fkdat AS bill_date,\n  sales.werks AS whs,\n  sales.vtweg AS dist_chnl_id,\n  sales.zzfinclass AS fnc_id,\n  sales.bezek AS fnc_desc,\n  sales.soldto_kunnr AS soldto,\n  sales.shipto_kunnr AS shipto,\n  sales.vgbel AS rfrnc_doc_num,\n  sales.distinct_vbeln_count AS invoice_lines,\n  sales.unit_land_cost AS unit_land_cost,\n  sales.so_netwr AS so_netvalue_amt,\n  sales.so_netpr AS so_netprice_amt,\n  sales.extnd_land_cst AS landed_cost,\n  sales.extnd_invoice_price_per_itm AS extended_invoice_price,\n  sales.extnd_fnl_price AS extended_final_price,\n  sales.extnd_servc_fee AS service_fee,\n  sales.extnd_shpng_hndlng AS ext_ship_hndl,\n  sales.xtnd_state_tx AS ext_state_tax,\n  sales.extnd_lcl_tx AS ext_local_tax,\n  sales.base_qty AS base_qty,\n  sales.sell_qty AS sell_qty,\n  sales.vendor_trans_absorb AS vendor_trans_absorb,\n  sales.vendor_drop_ship_absorb AS vendor_drop_ship_absorb,\n  sales.ext_hndl_drop_absorb AS ext_hndl_drop_absorb,\n  sales.vendor_moc_absorb AS vendor_moc_absorb,\n  sales.trans_absorb_amt AS trans_absorb_amt,\n  sales.trans_charge_amt AS trans_charge_amt,\n  sales.restock_fee AS restock_fee,\n  sales.restock_fee_man AS restock_fee_man,\n  sales.special_hndl_amt AS special_hndl_amt,\n  sales.vendor_hndl_amt AS vendor_hndl_amt,\n  sales.moc_amt AS moc_amt,\n  sales.moc_drop_amt AS moc_drop_amt,\n  sales.fuel_surcharge AS fuel_surcharge,\n  sales.fuel_override_amt AS fuel_override_amt,\n  sales.vendor_drop_ship_fee AS vendor_drop_ship_fee,\n  sales.markup_vendor_trans AS markup_vendor_trans,\n  sales.markup_hndl_fee AS markup_hndl_fee,\n  sales.bulk_dist_fee AS bulk_dist_fee,\n  sales.vl_srvc_fee AS vl_srvc_fee,\n  sales.ext_vl_svc_fee AS ext_vl_svc_fee,\n  sales.lum_dist_fee AS lum_dist_fee,\n  sales.onsite_rep_fee AS onsite_rep_fee,\n  sales.hldy_dlvr_fee AS hldy_dlvr_fee,\n  sales.addl_trns_fee AS addl_trns_fee,\n  sales.addl_trns_fee_ovrd AS addl_trns_fee_ovrd,\n  sales.dropship_fee AS dropship_fee,\n  sales.gov_fee AS gov_fee,\n  sales.invoice_sales AS invoice_sales,\n  sales.ext_sales_amt AS extended_sales,\n  sales.dist_chnl_desc AS dist_chnl_desc,\n  sales.vendor_trans_charge AS vendor_trans_charge,\n  sales.coe_ship_hndl_amt AS coe_ship_hndl_amt,\n  sales.bia_ship_hndl_amt AS bia_ship_hndl_amt,\n  sales.rush_order_fee AS rush_order_fee,\n  sales.run_date AS run_date,\n  sales.start_date AS start_date,\n  sales.end_date AS end_date,\n  sales.starttxt AS starttxt,\n  sales.endtxt AS endtxt,\n  sales.start_2wk AS start_2wk,\n  sales.end_2wk AS end_2wk,\n  sales.end_1wk AS end_1wk,\n  sales.start_3wk AS start_3wk,\n  sales.end_3wk AS end_3wk,\n  sales.start_4wk AS start_4wk,\n  sales.end_4wk AS end_4wk,\n  sales.start_5wk AS start_5wk,\n  sales.end_5wk AS end_5wk,\n  sales.null_yn AS null_yn\nFROM\n  `project.dataset.sales_data` AS sales\nJOIN\n  date_conversions AS dates\nON\n  sales.run_date BETWEEN dates.p3m_start AND dates.today\nWHERE\n  sales.null_yn = 'N'\nORDER BY\n  sales.run_date DESC\n"