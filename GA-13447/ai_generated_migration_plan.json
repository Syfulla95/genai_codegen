{
    "Migration Plan": [
        {
            "step": "create_dataiku_project",
            "parameters": {
                "project_key": "INSURANCE_CUSTOMER_INSIGHTS",
                "name": "Insurance Customer Insights",
                "description": "Comprehensive Data Integration and Customer Insights Using Alteryx",
                "owner": "admin"
            }
        },
        {
            "step": "create_file_datasets",
            "parameters": {
                "project_key": "INSURANCE_CUSTOMER_INSIGHTS",
                "connection_name": "filesystem_managed",
                "datasets": [
                    {
                        "name": "policy_data",
                        "path": "policy.xlsx"
                    },
                    {
                        "name": "claims_data",
                        "path": "claims.csv"
                    },
                    {
                        "name": "demographics_data",
                        "path": "demographics.xlsx"
                    },
                    {
                        "name": "scores_data",
                        "path": "scores.xlsx"
                    },
                    {
                        "name": "aiml_insights_data",
                        "path": "aiml_insights.xlsx"
                    }
                ]
            }
        },
        {
            "step": "create_prepare_recipe",
            "parameters": {
                "project_key": "INSURANCE_CUSTOMER_INSIGHTS",
                "recipe_name": "select_policy_fields",
                "input_dataset": "policy_data",
                "output_dataset": "selected_policy_data",
                "actions": [
                    {
                        "action": "SelectColumns",
                        "params": {
                            "keep": [
                                "Policy_ID",
                                "Customer_ID",
                                "Policy_Type",
                                "Policy_Status",
                                "Policy_Start_Date",
                                "Policy_End_Date",
                                "Policy_Term",
                                "Policy_Premium",
                                "Total_Premium_Paid",
                                "Renewal_Status",
                                "Policy_Addons"
                            ]
                        }
                    }
                ]
            }
        },
        {
            "step": "create_prepare_recipe",
            "parameters": {
                "project_key": "INSURANCE_CUSTOMER_INSIGHTS",
                "recipe_name": "select_claims_fields",
                "input_dataset": "claims_data",
                "output_dataset": "selected_claims_data",
                "actions": [
                    {
                        "action": "SelectColumns",
                        "params": {
                            "keep": [
                                "Claim_ID",
                                "Policy_ID",
                                "Claim_Date",
                                "Claim_Type",
                                "Claim_Status",
                                "Claim_Amount",
                                "Claim_Payout"
                            ]
                        }
                    }
                ]
            }
        },
        {
            "step": "create_prepare_recipe",
            "parameters": {
                "project_key": "INSURANCE_CUSTOMER_INSIGHTS",
                "recipe_name": "select_demographics_fields",
                "input_dataset": "demographics_data",
                "output_dataset": "selected_demographics_data",
                "actions": [
                    {
                        "action": "SelectColumns",
                        "params": {
                            "keep": [
                                "Customer_ID",
                                "Customer_Name",
                                "Email",
                                "Phone_Number",
                                "Address",
                                "City",
                                "State",
                                "Postal_Code",
                                "Date_of_Birth",
                                "Gender",
                                "Marital_Status",
                                "Occupation",
                                "Income_Level",
                                "Customer_Segment"
                            ]
                        }
                    }
                ]
            }
        },
        {
            "step": "create_prepare_recipe",
            "parameters": {
                "project_key": "INSURANCE_CUSTOMER_INSIGHTS",
                "recipe_name": "select_scores_fields",
                "input_dataset": "scores_data",
                "output_dataset": "selected_scores_data",
                "actions": [
                    {
                        "action": "SelectColumns",
                        "params": {
                            "keep": [
                                "Customer_ID",
                                "Credit_Score",
                                "Fraud_Score",
                                "Customer_Risk_Score"
                            ]
                        }
                    }
                ]
            }
        },
        {
            "step": "create_prepare_recipe",
            "parameters": {
                "project_key": "INSURANCE_CUSTOMER_INSIGHTS",
                "recipe_name": "select_aiml_insights_fields",
                "input_dataset": "aiml_insights_data",
                "output_dataset": "selected_aiml_insights_data",
                "actions": [
                    {
                        "action": "SelectColumns",
                        "params": {
                            "keep": [
                                "Customer_ID",
                                "Churn_Probability",
                                "Next_Best_Offer",
                                "Claims_Fraud_Probability",
                                "Revenue_Potential"
                            ]
                        }
                    }
                ]
            }
        },
        {
            "step": "create_join_recipe",
            "parameters": {
                "project_key": "INSURANCE_CUSTOMER_INSIGHTS",
                "recipe_name": "join_demographics_policy",
                "left_input": "selected_demographics_data",
                "right_input": "selected_policy_data",
                "output_dataset": "joined_demographics_policy",
                "join_type": "INNER",
                "join_conditions": [
                    {
                        "left_column": "Customer_ID",
                        "right_column": "Customer_ID",
                        "operator": "EQ"
                    }
                ]
            }
        },
        {
            "step": "create_join_recipe",
            "parameters": {
                "project_key": "INSURANCE_CUSTOMER_INSIGHTS",
                "recipe_name": "join_policy_claims",
                "left_input": "joined_demographics_policy",
                "right_input": "selected_claims_data",
                "output_dataset": "joined_policy_claims",
                "join_type": "INNER",
                "join_conditions": [
                    {
                        "left_column": "Policy_ID",
                        "right_column": "Policy_ID",
                        "operator": "EQ"
                    }
                ]
            }
        },
        {
            "step": "run_aggregation_flow",
            "parameters": {
                "project_key": "INSURANCE_CUSTOMER_INSIGHTS",
                "input_dataset": "joined_policy_claims",
                "output_dataset": "summarized_data",
                "group_by": [
                    "Customer_ID"
                ],
                "aggregations": [
                    {
                        "column": "Claim_ID",
                        "aggregation_type": "count",
                        "output_column": "Total_Claims"
                    },
                    {
                        "column": "Claim_Date",
                        "aggregation_type": "max",
                        "output_column": "Recent_Claim_Date"
                    },
                    {
                        "column": "Claim_Amount",
                        "aggregation_type": "avg",
                        "output_column": "Average_Claim_Amount"
                    },
                    {
                        "column": "Policy_ID",
                        "aggregation_type": "count",
                        "output_column": "Policy_Count"
                    }
                ]
            }
        },
        {
            "step": "create_join_recipe",
            "parameters": {
                "project_key": "INSURANCE_CUSTOMER_INSIGHTS",
                "recipe_name": "join_summarized_data",
                "left_input": "joined_policy_claims",
                "right_input": "summarized_data",
                "output_dataset": "joined_summarized_data",
                "join_type": "INNER",
                "join_conditions": [
                    {
                        "left_column": "Customer_ID",
                        "right_column": "Customer_ID",
                        "operator": "EQ"
                    }
                ]
            }
        },
        {
            "step": "generate_and_create_dataiku_code_recipe",
            "parameters": {
                "project_key": "INSURANCE_CUSTOMER_INSIGHTS",
                "input_dataset_name": "joined_summarized_data",
                "output_dataset_name": "calculated_data",
                "recipe_name": "calculate_custom_fields",
                "run_recipe": true,
                "transformations": [
                    {
                        "action": "add_column",
                        "parameters": {
                            "column_name": "Age",
                            "formula": "DateTimeDiff(DateTimeToday(), Date_of_Birth, 'years')"
                        }
                    },
                    {
                        "action": "add_column",
                        "parameters": {
                            "column_name": "Claim_To_Premium_Ratio",
                            "formula": "if(Total_Premium_Paid != 0, Claim_Amount / Total_Premium_Paid, 0)"
                        }
                    },
                    {
                        "action": "add_column",
                        "parameters": {
                            "column_name": "Claims_Per_Policy",
                            "formula": "if(Policy_Count != 0, Total_Claims / Policy_Count, 0)"
                        }
                    },
                    {
                        "action": "add_column",
                        "parameters": {
                            "column_name": "Retention_Rate",
                            "formula": "0.85"
                        }
                    },
                    {
                        "action": "add_column",
                        "parameters": {
                            "column_name": "Cross_Sell_Opportunities",
                            "formula": "'Multi-Policy Discount, Home Coverage Add-on'"
                        }
                    },
                    {
                        "action": "add_column",
                        "parameters": {
                            "column_name": "Upsell_Potential",
                            "formula": "'Premium Vehicle Coverage'"
                        }
                    }
                ]
            }
        },
        {
            "step": "create_and_run_stack_recipe",
            "parameters": {
                "input_datasets": [
                    "calculated_data",
                    "selected_aiml_insights_data",
                    "selected_scores_data"
                ],
                "output_dataset": "customer_360_view",
                "connection": "filesystem_managed",
                "output_format": "CSV",
                "project_key": "INSURANCE_CUSTOMER_INSIGHTS"
            }
        }
    ]
}