[
    {
        "step": "create_dataiku_project",
        "parameters": {
            "project_key": "CUSTOMER_360",
            "name": "Customer 360 Data Integration",
            "description": "Migrating Alteryx workflows for comprehensive Customer 360 view in insurance operations."
        }
    },
    {
        "step": "create_connection",
        "parameters": {
            "connection_name": "PolicyDataConnection",
            "connection_type": "CSV",
            "folder_path": "ApplicationsData/JNJDataverse/Customer360/",
            "dataset_name": "policy.csv",
            "connection_attributes": {
                "SampleFileUri": "tfs://dataeconomy-9k42/62457/uploads/62457/29aabe9d-c354-4176-8f98-2dd7a5fd7216/policy.csv",
                "DatasetId": "235775"
            }
        }
    },
    {
        "step": "create_connection",
        "parameters": {
            "connection_name": "ClaimsDataConnection",
            "connection_type": "CSV",
            "folder_path": "ApplicationsData/JNJDataverse/Customer360/",
            "dataset_name": "claims.csv",
            "connection_attributes": {
                "SampleFileUri": "tfs://dataeconomy-9k42/62457/uploads/62457/29aabe9d-c354-4176-8f98-2dd7a5fd7216/claims.csv",
                "DatasetId": "235777"
            }
        }
    },
    {
        "step": "create_connection",
        "parameters": {
            "connection_name": "DemographicsDataConnection",
            "connection_type": "CSV",
            "folder_path": "ApplicationsData/JNJDataverse/Customer360/",
            "dataset_name": "demographics.csv",
            "connection_attributes": {
                "SampleFileUri": "tfs://dataeconomy-9k42/62457/uploads/62457/29aabe9d-c354-4176-8f98-2dd7a5fd7216/demographics.csv",
                "DatasetId": "235778"
            }
        }
    },
    {
        "step": "create_connection",
        "parameters": {
            "connection_name": "ScoresDataConnection",
            "connection_type": "CSV",
            "folder_path": "ApplicationsData/JNJDataverse/Customer360/",
            "dataset_name": "scores.csv",
            "connection_attributes": {
                "SampleFileUri": "tfs://dataeconomy-9k42/62457/uploads/62457/29aabe9d-c354-4176-8f98-2dd7a5fd7216/scores.csv",
                "DatasetId": "235776"
            }
        }
    },
    {
        "step": "create_connection",
        "parameters": {
            "connection_name": "AIMLInsightsDataConnection",
            "connection_type": "CSV",
            "folder_path": "ApplicationsData/JNJDataverse/Customer360/",
            "dataset_name": "aiml_insights.csv",
            "connection_attributes": {
                "SampleFileUri": "tfs://dataeconomy-9k42/62457/uploads/62457/29aabe9d-c354-4176-8f98-2dd7a5fd7216/aiml_insights.csv",
                "DatasetId": "235774"
            }
        }
    },
    {
        "step": "import_dataset",
        "parameters": {
            "connection_name": "PolicyDataConnection",
            "dataset_name": "policy.csv"
        }
    },
    {
        "step": "import_dataset",
        "parameters": {
            "connection_name": "ClaimsDataConnection",
            "dataset_name": "claims.csv"
        }
    },
    {
        "step": "import_dataset",
        "parameters": {
            "connection_name": "DemographicsDataConnection",
            "dataset_name": "demographics.csv"
        }
    },
    {
        "step": "import_dataset",
        "parameters": {
            "connection_name": "ScoresDataConnection",
            "dataset_name": "scores.csv"
        }
    },
    {
        "step": "import_dataset",
        "parameters": {
            "connection_name": "AIMLInsightsDataConnection",
            "dataset_name": "aiml_insights.csv"
        }
    },
    {
        "step": "create_recipe",
        "parameters": {
            "recipe_type": "Prepare",
            "input_datasets": [
                "demographics.csv"
            ],
            "output_dataset": "demographics_prepared",
            "operations": [
                {
                    "type": "Select",
                    "columns": [
                        "Customer_ID",
                        "Customer_Name",
                        "Email",
                        "Phone_Number",
                        "Address",
                        "City",
                        "State",
                        "Postal_Code",
                        "Date_of_Birth",
                        "Gender",
                        "Marital_Status",
                        "Occupation",
                        "Income_Level",
                        "Customer_Segment"
                    ]
                }
            ]
        }
    },
    {
        "step": "create_recipe",
        "parameters": {
            "recipe_type": "Prepare",
            "input_datasets": [
                "claims.csv"
            ],
            "output_dataset": "claims_prepared",
            "operations": [
                {
                    "type": "Select",
                    "columns": [
                        "Claim_ID",
                        "Policy_ID",
                        "Claim_Date",
                        "Claim_Type",
                        "Claim_Status",
                        "Claim_Amount",
                        "Claim_Payout"
                    ]
                }
            ]
        }
    },
    {
        "step": "create_recipe",
        "parameters": {
            "recipe_type": "Prepare",
            "input_datasets": [
                "policy.csv"
            ],
            "output_dataset": "policy_prepared",
            "operations": [
                {
                    "type": "Select",
                    "columns": [
                        "policy_id",
                        "customer_id",
                        "policy_type",
                        "policy_status",
                        "policy_start_date",
                        "policy_end_date",
                        "policy_term",
                        "policy_premium",
                        "total_premium_paid",
                        "renewal_status",
                        "policy_addons"
                    ]
                }
            ]
        }
    },
    {
        "step": "create_recipe",
        "parameters": {
            "recipe_type": "Join",
            "input_datasets": [
                "demographics_prepared",
                "policy_prepared"
            ],
            "output_dataset": "demographics_policy_joined",
            "join_type": "inner",
            "join_conditions": [
                {
                    "left_column": "Customer_ID",
                    "right_column": "customer_id"
                }
            ]
        }
    },
    {
        "step": "create_recipe",
        "parameters": {
            "recipe_type": "Join",
            "input_datasets": [
                "demographics_policy_joined",
                "claims_prepared"
            ],
            "output_dataset": "all_data_joined",
            "join_type": "inner",
            "join_conditions": [
                {
                    "left_column": "policy_id",
                    "right_column": "Policy_ID"
                }
            ]
        }
    },
    {
        "step": "create_recipe",
        "parameters": {
            "recipe_type": "Group",
            "input_datasets": [
                "all_data_joined"
            ],
            "output_dataset": "aggregated_data",
            "group_by": [
                "Customer_ID"
            ],
            "aggregations": [
                {
                    "column": "Claim_ID",
                    "type": "count",
                    "output_column": "Total_Claims"
                },
                {
                    "column": "policy_id",
                    "type": "count",
                    "output_column": "Policy_Count"
                },
                {
                    "column": "Claim_Date",
                    "type": "max",
                    "output_column": "Recent_Claim_Date"
                },
                {
                    "column": "Claim_Amount",
                    "type": "avg",
                    "output_column": "Average_Claim_Amount"
                }
            ]
        }
    },
    {
        "step": "create_recipe",
        "parameters": {
            "recipe_type": "Join",
            "input_datasets": [
                "aggregated_data",
                "all_data_joined"
            ],
            "output_dataset": "final_joined_data",
            "join_type": "inner",
            "join_conditions": [
                {
                    "left_column": "Customer_ID",
                    "right_column": "Customer_ID"
                }
            ]
        }
    },
    {
        "step": "create_recipe",
        "parameters": {
            "recipe_type": "Prepare",
            "input_datasets": [
                "final_joined_data"
            ],
            "output_dataset": "final_calculated_data",
            "operations": [
                {
                    "type": "Formula",
                    "output_column": "Age",
                    "formula": "DateTimeDiff(DateTimeToday(), [Date_of_Birth], 'years')"
                },
                {
                    "type": "Formula",
                    "output_column": "Claim_To_Premium_Ratio",
                    "formula": "IIF([total_premium_paid] != 0, [Claim_Amount]/[total_premium_paid], 0)"
                },
                {
                    "type": "Formula",
                    "output_column": "Claims_Per_Policy",
                    "formula": "IIF([Policy_Count] != 0, [Total_Claims]/[Policy_Count], 0)"
                },
                {
                    "type": "Formula",
                    "output_column": "Retention_Rate",
                    "formula": "0.85"
                },
                {
                    "type": "Formula",
                    "output_column": "Cross_Sell_Opportunities",
                    "formula": "\"Multi-Policy Discount, Home Coverage Add-on\""
                },
                {
                    "type": "Formula",
                    "output_column": "Upsell_Potential",
                    "formula": "\"Premium Vehicle Coverage\""
                }
            ]
        }
    },
    {
        "step": "create_recipe",
        "parameters": {
            "recipe_type": "Prepare",
            "input_datasets": [
                "aiml_insights.csv"
            ],
            "output_dataset": "aiml_insights_prepared",
            "operations": [
                {
                    "type": "Select",
                    "columns": [
                        "Customer_ID",
                        "Churn_Probability",
                        "Next_Best_Offer",
                        "Claims_Fraud_Probability",
                        "Revenue_Potential"
                    ]
                }
            ]
        }
    },
    {
        "step": "create_recipe",
        "parameters": {
            "recipe_type": "Prepare",
            "input_datasets": [
                "scores.csv"
            ],
            "output_dataset": "scores_prepared",
            "operations": [
                {
                    "type": "Select",
                    "columns": [
                        "Customer_ID",
                        "Credit_Score",
                        "Fraud_Score",
                        "Customer_Risk_Score"
                    ]
                }
            ]
        }
    },
    {
        "step": "create_recipe",
        "parameters": {
            "recipe_type": "Join",
            "input_datasets": [
                "final_calculated_data",
                "aiml_insights_prepared",
                "scores_prepared"
            ],
            "output_dataset": "customer_360_final",
            "join_type": "inner",
            "join_conditions": [
                {
                    "left_column": "Customer_ID",
                    "right_column": "Customer_ID"
                }
            ]
        }
    },
    {
        "step": "export_dataset",
        "parameters": {
            "dataset_name": "customer_360_final",
            "output_path": "ApplicationsData/JNJDataverse/Customer360/Customer_360.csv",
            "format": "CSV"
        }
    }
]